<div class="logs-layout">
  <!-- 左ペイン：検索・フィルタ・一覧 -->
  <section class="logs-pane-list card">
    <!-- 左ペインヘッダー -->
    <header class="logs-pane-header">
      <div>
        <h1 class="logs-pane-title">学習ログ</h1>
        <p class="logs-pane-subtitle">
          キーワード・タグ・カテゴリで、手元のナレッジをすばやく絞り込みできます。
        </p>
      </div>
      <div class="logs-pane-header-actions">
        <%= link_to "＋ 新規ログ", new_log_path, class: "btn-accent" %>
        <%= link_to "カテゴリ管理", categories_path, class: "btn-subtle" %>
      </div>
    </header>

    <!-- 絞り込みフォーム -->
    <div class="logs-filters">
      <%= form_with url: logs_path, method: :get, local: true, class: "filters-form" do |f| %>
        <div class="filters-row">
          <div class="filters-block filters-block-wide">
            <%= f.label :q, "検索" %>
            <%= f.search_field :q,
                  value: params[:q],
                  placeholder: "キーワード（タイトル / 本文 / コード）" %>
          </div>

          <div class="filters-block">
            <%= label_tag :tag, "タグ" %>
            <%= text_field_tag :tag, params[:tag],
                  list: "tag-suggestions",
                  placeholder: "例）rails, vlookup など" %>
            <datalist id="tag-suggestions">
              <% @tag_suggestions.each do |tag| %>
                <option value="<%= tag.name %>"></option>
              <% end %>
            </datalist>
          </div>

          <div class="filters-block">
            <%= f.label :category_id, "カテゴリ" %>
            <%= f.collection_select :category_id,
                  @categories, :id, :name,
                  { include_blank: "すべて" } %>
          </div>

          <div class="filters-block">
            <%= f.label :sort, "並び順" %>
            <%= f.select :sort,
                  [["更新日（新しい順）", "recent"],
                   ["使用頻度（コピー回数）", "used"]],
                  { selected: params[:sort] || "recent" } %>
          </div>

          <div class="filters-block filters-submit">
            <%= f.label :apply, "　" %>
            <%= f.submit "適用", class: "btn-accent filters-apply-button" %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- 一覧（ピン留め + 通常） -->
    <% if @pinned_logs.empty? && @other_logs.empty? %>
      <div class="empty-state logs-empty-hint">
        <p>まだ学習ログがありません。</p>
        <p>まずは「＋ 新規ログ」から、今日の学びを書いてみましょう。</p>
      </div>
    <% else %>
      <div class="logs-list-container">
        <% if @pinned_logs.any? %>
          <div class="logs-pinned">
            <div class="logs-section-header">
              <span class="logs-section-title">⭐ ピン留め中のログ</span>
              <span class="logs-section-caption">よく使うスニペットをここに集約できます。</span>
            </div>
            <% @pinned_logs.each do |log| %>
              <%= render "log_card", log: log, selected_log: @selected_log %>
            <% end %>
          </div>
        <% end %>

        <div class="logs-list">
          <div class="logs-section-header logs-section-header--compact">
            <span class="logs-section-title">すべてのログ</span>
            <span class="logs-section-caption">
              <%= @other_logs.size + @pinned_logs.size %> 件
            </span>
          </div>
          <% @other_logs.each do |log| %>
            <%= render "log_card", log: log, selected_log: @selected_log %>
          <% end %>
        </div>
      </div>
    <% end %>
  </section>


  <!-- 右ペイン：詳細 -->
  <section class="logs-pane-detail">
    <% if @selected_log %>
      <div class="log-detail-card">
        <%= render "detail", log: @selected_log %>
      </div>
    <% else %>
      <div class="log-detail-empty">
        <p>左の一覧からログを選択するか、新規ログを作成してください。</p>
      </div>
    <% end %>
  </section>
</div>
