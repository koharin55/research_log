<% active   = defined?(selected_log) && selected_log.present? && selected_log.id == log.id %>
<% log_url = logs_path(
      selected_id: log.id,
      q:          params[:q],
      tag:        params[:tag],
      category_id: params[:category_id],
      sort:       params[:sort]
    ) %>

<div class="log-card <%= 'is-active' if active %>"
     data-log-url="<%= log_url %>"
     role="link"
     tabindex="0">
  <div class="log-card-header">
    <%= link_to log.title, log_url, class: "log-card-title" %>
    
    <% if log.memo.present? %>
      <div class="log-card-memo">
        <%= truncate(log.memo.to_plain_text, length: 30) %>
      </div>
    <% end %>

    <%= button_to toggle_pin_log_path(log),
          method: :patch,
          class: "pin-button",
          form: { data: { turbo_confirm: nil } } do %>
      <span><%= log.pinned? ? "â­" : "â˜†" %></span>
    <% end %>
  </div>

  <div class="log-card-meta">
    <div class="log-card-tags">
      <% log.tags.each do |tag| %>
        <span class="tag-chip">#<%= tag.name %></span>
      <% end %>
    </div>

    <% if log.category %>
      <span class="category-pill">ðŸ“‚ <%= log.category.name %></span>
    <% end %>
  </div>

  <div class="log-card-footer">
    <span class="usage">ä½¿ç”¨å›žæ•°: <%= log.copy_count %>å›ž</span>
    <span class="updated">æ›´æ–°: <%= l(log.updated_at, format: :short) %></span>
  </div>
</div>
